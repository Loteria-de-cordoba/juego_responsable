<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>LPCSE - Control de ingreso a salas</title>

    <link rel="apple-touch-icon" sizes="180x180" href="assets/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/favicon-16x16.png">
    <link rel="manifest" href="assets//site.webmanifest">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">


    <link href="bootstrap-5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="bootstrap-5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>

    <script src="jquery-3.7.1/jquery-3.7.1.min.js"></script>
</head>

<body>
    <div class="container">



        <form class="row g-3 mt-2">


            <nav class="navbar" style="background-color: #b3d9ff;">
                <div class="container-fluid">
                    <a class="navbar-brand" href="#">
                        <img src="assets/logo-oficial-apaisado.png" alt="Logo" width="60" height="30"
                            class="d-inline-block align-text-top">
                        Control de ingreso a salas
                    </a>
                </div>
            </nav>



            <div class="col-12 text-left">
                <label for="inputEmail4" class="form-label">DNI</label>
                <div class="col-md-6">
                    <input type="text" class="form-control" id="dni" placeholder="numero">
                </div>
            </div>

            <div class="col-12 text-left">
                <label for="inputAddress" class="form-label">Sexo</label>
                <div class="col-12 btn-group" role="group" aria-label="Basic radio toggle button group">

                    <input type="radio" class="btn-check" class="form-control" name="P1" autocomplete="off" id="P1_0">
                    <label class="btn btn-outline-primary" for="P1_0">Masculino</label>

                    <input type="radio" class="btn-check" class="form-control" name="P1" autocomplete="off" id="P1_1">
                    <label class="btn btn-outline-primary" for="P1_1">Femenino</label>
                </div>
            </div>

            <div class="col-12 text-left">
                <label for="inputAddress" class="form-label">Fecha de nacimiento</label>
            </div>
            <div class="col-4 text-center">
                <input type="text" class="form-control" id="dia" placeholder="dia">
            </div>
            <div class="col-4 text-center">
                <input type="text" class="form-control" id="mes" placeholder="mes">
            </div>
            <div class="col-4 text-center">
                <input type="text" class="form-control" id="anio" placeholder="año">
            </div>


            <div class="col-12">
                <div class="d-grid gap-2">
                    <button type="button" id="aceptar" class="btn btn-primary"
                        onclick="consultarApiRest();">Consultar</button>
                </div>
            </div>
            <div class="col-12">
                <div class="d-grid gap-2">
                    <button type="button" id="aceptar" class="btn btn-info"
                        onclick="reiniciarForm();">Reiniciar</button>
                </div>
            </div>

        </form>

        <div class="alert alert-success mt-3" role="alert" id="alert_1">
            BIENVENIDO, Puede ingresar!...
        </div>
        <div class="alert alert-danger mt-3" role="alert" id="alert_2">
            AUTOEXCLUIDO, Ingreso denegado!...
        </div>
        <div class="alert alert-warning mt-3" role="alert" id="alert_3">
            EMPLEADO, Informar a Gerencia!...
        </div>
        <div class="alert alert-danger mt-3" role="alert" id="alert_4">
            <img src="assets/+18-02.png" alt="Logo" width="45" height="45" class="d-inline-block align-text-top">
            <p>Menor de Edad, Ingreso denegado!...</p>
        </div>

        <!-- <div class="alert alert-danger mt-3" role="alert" id="alert_4"> -->
        <!-- <img src="assets/+18-02.png" alt="Logo" width="45" height="45"
            class="d-inline-block align-text-top"> -->
        <div class="text-center" id="loading">
            <div class="spinner-border spinner-border-sm text-success mt-3 text-center" role="status">
                <!-- <span class="sr-only ">Loading...</span> -->
            </div>
        </div>
        <!-- </div> -->
        <!-- <div class="row ms-1 me-1 animated fadeIn fast"> -->
        <!-- <div class="col-12"> -->
        <!-- <div class="alert alert-success alert-dismissible text-center" role="alert"> -->
        <!-- <button type="button" class="btn-close" data-dismiss="alert" aria-label="Close"></button> -->
        <!-- <div class="alert-message text-center"> -->
        <!-- <h4 class=" alert-heading ml-5 ">Cargando...</h4> -->
        <!-- <div class="spinner-border spinner-border-sm text-danger mt-2 ms-5 text-center" role="status"> -->
        <!-- <span class="sr-only ">Loading...</span> -->
        <!-- </div> -->
        <!-- <hr /> -->
        <!-- <p class="mb-0 ml-5">Por favor espere...</p> -->
        <!-- </div> -->
        <!-- </div> -->
        <!-- </div> -->
        <!-- </div> -->

    </div>

</body>

<script>


    $(document).ready(function () {
       
        reiniciarForm();
        //$('#aceptar').prop('disabled', true);
        console.log("ready!");

        // alert(getAge(1969-12-29));

    });
    
    function reiniciarForm(){

        $('#dni').val("");
        $('#dia').val("");
        $('#mes').val("");
        $('#anio').val("");
        $('#alert_1').hide();
        $('#alert_2').hide();
        $('#alert_3').hide();
        $('#alert_4').hide();
        $('#loading').hide();
        $('#P1_0').prop("checked",false)
        $('#P1_1').prop("checked",false)

    }

    function validarform() {

        let validado = true;

        if (!$.isNumeric($('#dni').val())) {
            //console.log('El dni debe ser numerico!...');
            validado = false;
        }
        if (!$.isNumeric($('#dia').val())) {
            //console.log('El dia debe ser numerico!...');
            validado = false;
        }
        if (!$.isNumeric($('#mes').val())) {
            //console.log('El mes debe ser numerico!...');
            validado = false;
        }
        if (!$.isNumeric($('#anio').val())) {
            //console.log('El año debe ser numerico!...');
            validado = false;
        }

        let contestada = false;

        if ($('#P1_0').prop("checked")) {
            contestada = true;
        }

        if ($('#P1_1').prop("checked")) {
            contestada = true;
        }

        if (!contestada) {
            validado = false;
        }

        return validado;

    }

    function getAge(birth) {
        ageMS = Date.parse(Date()) - Date.parse(birth);
        age = new Date();
        age.setTime(ageMS);
        ageYear = age.getFullYear() - 1970;

        return ageYear;

        // ageMonth = age.getMonth(); // Accurate calculation of the month part of the age
        // ageDay = age.getDate();    // Approximate calculation of the day part of the age
    }




    function consultarApiRest() {

      

        const fecha_nac = `${$('#anio').val()}-${$('#mes').val()}-${$('#dia').val()}`;
        // alert(getAge(fecha_nac));
        if (getAge(fecha_nac) < 18) {
            $('#alert_1').hide();
            $('#alert_2').hide();
            $('#alert_3').hide();
            $('#alert_4').show();
            // alert('Menor de edad!...');
            return false;
        }

        let validado = validarform();

        if (!validado) {
            alert("Falta un completar un campo!...");
            return false;
        }

        let sexo = "";

        if ($('#P1_0').prop("checked")) {
            sexo = 'M';
        } else if ($('#P1_1').prop("checked")) {
            sexo = 'F'
        }

        variables = {
            dni: $('#dni').val(),
            sexo: sexo,
            anio: $('#anio').val(),
            mes: $('#mes').val(),
            dia: $('#dia').val()
        };

        $('#alert_1').hide();
        $('#alert_2').hide();
        $('#alert_3').hide();
        $('#alert_4').hide();
        $('#loading').show();


        $.ajax({
            type: "POST",
            //url: 'https://localhost/control-ingreso-salas/index.php',
            url: 'https://late-agenciero.loteriacba.com.ar/ingreso-backend-php-oci/index.php',
            data: JSON.stringify(variables),
            dataType: 'json'
        }).done(function (data) {
            // alert("Data Loaded: " + data);
            console.log(data);
            var obj = jQuery.parseJSON(data);
            console.log(obj);
            if (obj.message === "Excluded gambler" && obj.type === "EMPLEADO") {
                $('#alert_1').hide();
                $('#alert_2').hide();
                $('#alert_3').show();
                $('#alert_4').hide();
                $('#loading').hide();
            } else if (obj.message === "Invalid person") {
                $('#alert_1').show();
                $('#alert_2').hide();
                $('#alert_3').hide();
                $('#alert_4').hide();
                $('#loading').hide();
                console.log('Invalid person');
            } else if (obj.message === "Excluded gambler") {
                $('#alert_1').hide();
                $('#alert_2').show();
                $('#alert_3').hide();
                $('#alert_4').hide();
                $('#loading').hide();
            }


        }).fail(function () {
            alert("Error, no se pudo realizar la consulta!...");
        }).always(function () {
            // alert("finished");
        });

        // var jqxhr = $.post("https://late-agenciero.loteriacba.com.ar/ingreso-backend-php-oci/index.php", variables, function () {
        //     alert("success");
        // })
        //     .done(function (data) {
        //         alert("Data Loaded: " + data);
        //         console.log(data);
        //         var obj = jQuery.parseJSON(data);
        //         console.log(obj);

        //         if (obj.message === "Excluded gambler" && obj.type === "EMPLEADO") {
        //             $('#alert_3').show();
        //         }

        //     })
        //     .fail(function () {
        //         alert("Error, no se pudo realizar la consulta!...");
        //     })
        //     .always(function () {
        //         alert("finished");
        //     });
    }

</script>