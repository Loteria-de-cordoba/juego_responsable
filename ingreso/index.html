<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">


    <link href="bootstrap-5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="bootstrap-5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>

    <script src="jquery-3.7.1/jquery-3.7.1.min.js"></script>
</head>

<body>
    <div class="container">



        <form class="row g-3 mt-2">

            <!-- As a link -->
            <nav class="navbar navbar-info bg-info">
                <div class="container-fluid">
                    <a class="navbar-brand" href="#">Control de ingreso</a>
                </div>
            </nav>


            <div class="col-12 text-left">
                <label for="inputEmail4" class="form-label">DNI</label>
                <div class="col-md-6">
                    <input type="text" onblur="validarform()" class="form-control"  id="dni" placeholder="numero">
                </div>
            </div>

            <div class="col-12 text-left">
                <label for="inputAddress" class="form-label">Sexo</label>
                <div class="col-12 btn-group" role="group" aria-label="Basic radio toggle button group">

                    <input type="radio" class="btn-check" class="form-control" name="P1" autocomplete="off" id="P1_0">
                    <label class="btn btn-outline-primary" onclick="validarform()" for="P1_0">Masculino</label>

                    <input type="radio" class="btn-check" class="form-control" name="P1" autocomplete="off" id="P1_1">
                    <label class="btn btn-outline-primary" onclick="validarform()" for="P1_1">Femenino</label>
                </div>
            </div>

            <div class="col-12 text-left">
                <label for="inputAddress" class="form-label">Fecha de nacimiento</label>
            </div>
            <div class="col-4 text-center">
                <input type="text" class="form-control" onblur="validarform()" id="dia" placeholder="dia">
            </div>
            <div class="col-4 text-center">
                <input type="text" class="form-control" onblur="validarform()" id="mes" placeholder="mes">
            </div>
            <div class="col-4 text-center">
                <input type="text" class="form-control" onblur="validarform()" id="anio" placeholder="año">
            </div>


            <div class="col-12">
                <div class="d-grid gap-2">
                    <button type="button" id="aceptar" class="btn btn-primary"
                        onclick="consultarApiRest();">Consultar</button>
                </div>
            </div>

        </form>

        <div class="alert alert-success mt-3" role="alert" id="alert_1">
            BIENVENIDO, Puede ingresar!...
        </div>
        <div class="alert alert-danger mt-3" role="alert" id="alert_2">
            AUTOEXCLUIDO, Ingreso denegado!...
        </div>
        <div class="alert alert-warning mt-3" role="alert" id="alert_3">
            EMPLEADO, Informar a Gerencia!...
        </div>

    </div>

</body>

<script>

    $(document).ready(function () {
        $('#dni').val("");
        $('#dia').val("");
        $('#mes').val("");
        $('#anio').val("");
        $('#alert_1').hide();
        $('#alert_2').hide();
        $('#alert_3').hide();
        $('#aceptar').prop('disabled', true);
        console.log("ready!");

    });

    function validarform() {

        //console.log($('#dni').val());

        let validado = true;

        if (!$.isNumeric($('#dni').val())) {
            //console.log('El dni debe ser numerico!...');
            validado = false;
        }
        if (!$.isNumeric($('#dia').val())) {
            //console.log('El dia debe ser numerico!...');
            validado = false;
        }
        if (!$.isNumeric($('#mes').val())) {
            //console.log('El mes debe ser numerico!...');
            validado = false;
        }
        if (!$.isNumeric($('#anio').val())) {
            //console.log('El año debe ser numerico!...');
            validado = false;
        }

        let contestada = false;

        if ($('#P1_0').prop("checked")) {
            contestada = true;
        }

        if ($('#P1_1').prop("checked")) {
            contestada = true;
        }

        if (!contestada) {
            validado = false;
        }


        if (validado) {
            $('#aceptar').prop('disabled', false);
        } else {
            $('#aceptar').prop('disabled', true);
        }


    }


    function consultarApiRest() {

        var sexo = "";

        if ($('#P1_0').prop("checked", true)) {
            sexo = 'M';
        } else if ($('#P1_0').prop("checked", true)) {
            sexo = 'F'
        }

        variables = {
            dni: $('#dni').val(),
            sexo: sexo,
            anio: $('#anio').val(),
            mes: $('#mes').val(),
            dia: $('#dia').val()
        };

        var jqxhr = $.post("https://late-agenciero.loteriacba.com.ar/ingreso-backend-php-oci/index.php", variables, function () {
            //alert("success");
        })
            .done(function (data) {
                // alert("Data Loaded: " + data);
                // console.log(data);
                var obj = jQuery.parseJSON(data);
                console.log(obj);

                if (obj.message === "Excluded gambler" && obj.type === "EMPLEADO") {
                    $('#alert_3').show();
                }

            })
            .fail(function () {
                alert("Error, no se pudo realizar la consulta!...");
            })
            .always(function () {
                // alert("finished");
            });
    }

</script>